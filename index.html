<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ラヴィPG 指名フローチャート（デモ／セーフモード）</title>
  <meta name="format-detection" content="telephone=no">
  <style>
    /* ---- セーフモード：白背景＋最小構成（クリック阻害要素ゼロ） ---- */
    html, body { margin:0; padding:0; background:#fff; color:#222; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; }
    .wrap { max-width: 760px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 20px; margin: 0 0 6px; }
    .sub { color:#666; margin: 0 0 12px; font-size: 14px; }
    .card, #result { border: 1px solid #ccc; border-radius: 10px; padding: 14px; background:#fff; }
    .hidden { display:none; }
    h2 { margin: 0 0 10px; font-size: 18px; }
    .choices { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin: 6px 0; }
    button.choice, .btn, .ghost {
      -webkit-tap-highlight-color: transparent;
      padding: 14px 12px; font-size: 16px; border-radius: 10px; border: 1px solid #bbb; background:#f5f5f5; cursor:pointer; text-align:center;
    }
    button.choice:active, .btn:active { transform: translateY(1px); }
    .progress { text-align:right; color:#888; font-size:12px; margin-top: 6px; }
    .pg-list { display:grid; gap:10px; margin-top: 8px; }
    .pg { display:flex; align-items:center; justify-content:space-between; gap:10px; border:1px solid #ddd; border-radius:10px; padding:10px 12px; background:#fff; }
    .pg h3 { margin:0 0 4px; font-size:16px; }
    .comment { margin:0; color:#444; font-size:14px; }
    .btn { background:#2b6be4; color:#fff; border-color:#2b6be4; text-decoration:none; display:inline-block; }
    .url-line { margin-top:6px; font-size: 12px; }
    .url-line a { color:#2b6be4; word-break: break-all; }
    .ghost { background:#fff; border-color:#bbb; color:#333; margin-top:8px; }
    footer { color:#888; text-align:right; font-size:12px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>PG指名フローチャート（デモ／セーフモード）</h1>
      <p class="sub">4つの質問に答えると、おすすめPGを表示します。</p>
    </header>

    <section id="card" class="card"><!-- JSで上書き --></section>

    <section id="result" class="hidden">
      <h2>おすすめのPG</h2>
      <div id="pgList" class="pg-list"></div>
      <button id="restart" class="ghost" type="button">最初からやり直す</button>
    </section>

    <footer>
      <small>※デモ用：結果画面から公式サイトの作品ページへ遷移します</small>
    </footer>
  </div>

  <script>
    // ====== 設定：デフォルト遷移先（神戸一覧） ======
    const DEFAULT_PORTFOLIO_URL = "https://www.la-viephoto.com/photo_g/kobe";

    // ====== データ（内蔵）======
    const DATA = {
      "nodes": [
        { "id": "q1", "question": "好きな写真の雰囲気は？", "progress": "1 / 4",
          "choices": [
            { "label": "スタイリッシュ", "next": "q2_stylish" },
            { "label": "ナチュラル",     "next": "q2_natural" }
          ]
        },

        { "id": "q2_stylish", "question": "どんな人に撮ってもらいたい？", "progress": "2 / 4",
          "choices": [
            { "label": "楽しい",  "next": "q3_stylish_fun" },
            { "label": "寄り添い","next": "q3_stylish_yorisoi" }
          ]
        },
        { "id": "q2_natural", "question": "どんな人に撮ってもらいたい？", "progress": "2 / 4",
          "choices": [
            { "label": "楽しい",  "next": "q3_natural_fun" },
            { "label": "寄り添い","next": "q3_natural_yorisoi" }
          ]
        },

        // スタイリッシュ × 楽しい
        { "id": "q3_stylish_fun", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "オシャレ＆かっこいい",     "next": "q4_gender_stylish_fun" },
            { "label": "上品で洗練されている",     "results": ["tatsuki"] }
          ]
        },
        { "id": "q4_gender_stylish_fun", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["taihei", "kenji"] },
            { "label": "WOMAN", "results": ["shiori"] }
          ]
        },

        // スタイリッシュ × 寄り添い
        { "id": "q3_stylish_yorisoi", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "オシャレ＆かっこいい",     "next": "q4_gender_stylish_yorisoi" },
            { "label": "上品で洗練されている",     "results": ["Rio"] }
          ]
        },
        { "id": "q4_gender_stylish_yorisoi", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["takuya"] },
            { "label": "WOMAN", "results": ["iwami"] }
          ]
        },

        // ナチュラル × 楽しい
        { "id": "q3_natural_fun", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "はっきり",       "results": ["konishi", "daisuke"] },
            { "label": "淡い・優しい",   "results": ["zacky", "uchida"] }
          ]
        },

        // ナチュラル × 寄り添い
        { "id": "q3_natural_yorisoi", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "はっきり",       "next": "q4_gender_natural_yorisoi_hakkiri" },
            { "label": "淡い・優しい",   "next": "q4_gender_natural_yorisoi_awai" }
          ]
        },
        { "id": "q4_gender_natural_yorisoi_hakkiri", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["bessy"] },
            { "label": "WOMAN", "results": ["Reika"] }
          ]
        },
        { "id": "q4_gender_natural_yorisoi_awai", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["motti"] },
            { "label": "WOMAN", "results": ["honoka"] }
          ]
        }
      ],
      "photographers": [
        { "id": "taihei",  "name": "taihei",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "kenji",   "name": "kenji",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "shiori",  "name": "shiori",  "comment": "寄り添いタイプ。二人の雰囲気＋おしゃれな写真を残せる", "portfolio_url": "https://www.la-viephoto.com/photo_g/shiori-sugimoto" },
        { "id": "tatsuki", "name": "tatsuki", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "takuya",  "name": "takuya",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "iwami",   "name": "iwami",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "Rio",     "name": "Rio",     "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "konishi", "name": "konishi", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "daisuke", "name": "daisuke", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "zacky",   "name": "zacky",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "uchida",  "name": "uchida",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "bessy",   "name": "bessy",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "Reika",   "name": "Reika",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "motti",   "name": "motti",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "honoka",  "name": "honoka",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" }
      ]
    };

    // ====== ロジック：results方式（最小実装） ======
    const state = { step: "q1", results: null };

    function findNode(id) { return DATA.nodes.find(n => n.id === id); }
    function resolvePhotographers(ids) {
      const map = new Map(DATA.photographers.map(p => [p.id, p]));
      return ids.map(id => map.get(id)).filter(Boolean);
    }

    function renderQuestion(node) {
      const el = document.getElementById('card');
      el.classList.remove('hidden');
      document.getElementById('result').classList.add('hidden');

      el.innerHTML = `
        <h2>${node.question}</h2>
        <div class="choices">
          ${node.choices.map(c => `
            <button class="choice"
              data-next='${c.next || ""}'
              data-results='${c.results ? JSON.stringify(c.results) : ""}'>
              ${c.label}
            </button>
          `).join('')}
        </div>
        <div class="progress">${node.progress || ""}</div>
      `;

      el.querySelectorAll('.choice').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const t = e.currentTarget;
          const resultsStr = t.getAttribute('data-results');
          if (resultsStr) {
            try { state.results = JSON.parse(resultsStr); } catch { state.results = []; }
            state.step = "FINAL"; run(); return;
          }
          const next = t.getAttribute('data-next');
          state.step = next || "FINAL"; run();
        });
      });
    }

    function renderResult() {
      const ids = Array.isArray(state.results) ? state.results : [];
      const list = resolvePhotographers(ids);
      const wrap = document.getElementById('pgList');

      wrap.innerHTML = list.map(p => {
        const url = (p.portfolio_url && p.portfolio_url.trim()) || DEFAULT_PORTFOLIO_URL;
        return `
          <article class="pg">
            <div>
              <h3>${p.name}</h3>
              ${p.comment ? `<p class="comment">${p.comment}</p>` : ``}
            </div>
            <div style="text-align:right; min-width:160px;">
              ${url}作品を見る</button>
              <div class="url-line"><a href="${}</a></div>
            </div>
          </article>
        `;
      }).join('') || `<p>該当のPGが見つかりませんでした。</p>`;

      document.getElementById('card').classList.add('hidden');
      const r = document.getElementById('result');
      r.classList.remove('hidden');

      // 100%遷移させる：同一タブで明示遷移
      r.querySelectorAll('.open-link').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const href = e.currentTarget.getAttribute('data-href');
          if (href) window.location.href = href;  // ← 同一タブで必ず遷移
        });
      });

      document.getElementById('restart').onclick = () => {
        state.step = "q1";
        state.results = null;
        run();
      };
    }

    function run() {
      if (state.step === "FINAL") { renderResult(); return; }
      const node = findNode(state.step);
      if (!node) { state.step = "FINAL"; renderResult(); return; }
      renderQuestion(node);
    }

    // 初期描画
    run();
  </script>
</body>
</html>
