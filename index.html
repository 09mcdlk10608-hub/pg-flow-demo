<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ラヴィPG 指名フローチャート（デモ）</title>
  <meta name="format-detection" content="telephone=no">
  <style>
    :root { color-scheme: light dark; --bg:#111; --fg:#fff; --accent:#4B8CFB; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; }
    .app { max-width: 760px; margin: 0 auto; padding: 16px; }
    header { margin: 8px 0 16px; }
    h1 { font-size: 1.25rem; margin: 0 0 4px; }
    .sub { color: #888; margin: 0 0 8px; }
    .card, #result { border: 1px solid #333; border-radius: 12px; padding: 16px; }
    .hidden { display: none; }
    h2 { margin: 0 0 8px; font-size: 1.1rem; }
    .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 8px; }
    .choice, .btn, .ghost {
      padding: 14px 12px; font-size: 1rem; border-radius: 10px; border: 1px solid #444;
      background: #222; color: #fff; cursor: pointer;
      text-align: center; display: inline-block; text-decoration: none;
    }
    .choice:hover, .btn:hover { border-color: var(--accent); }
    .progress { margin-top: 10px; color:#888; text-align: right; }
    .pg-list { display: grid; gap: 12px; margin-top: 8px; }
    .pg { display: flex; align-items: center; justify-content: space-between; gap: 12px;
          border: 1px solid #333; border-radius: 10px; padding: 10px 12px; }
    .pg h3 { margin: 0 0 2px; font-size: 1rem; }
    .comment { margin: 6px 0 0; line-height: 1.4; }
    footer { margin-top: 10px; color:#888; text-align: right; }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>PG指名フローチャート（デモ）</h1>
      <p class="sub">4つの質問に答えると、おすすめPGを表示します。</p>
    </header>

    <section id="card" class="card hidden"></section>

    <section id="result" class="hidden">
      <h2>おすすめのPG</h2>
      <div id="pgList" class="pg-list"></div>
      <button id="restart" class="ghost">最初からやり直す</button>
    </section>

    <footer>
      <small>※デモ用：結果画面から公式サイトの作品ページにリンクします</small>
    </footer>
  </main>

  <script>
    // ====== 設定：デフォルト遷移先（神戸一覧） ======
    const DEFAULT_PORTFOLIO_URL = "https://www.la-viephoto.com/photo_g/kobe";

    // ====== データ（data.json を内蔵）======
    const DATA = {
      "nodes": [
        { "id": "q1", "question": "好きな写真の雰囲気は？", "progress": "1 / 4",
          "choices": [
            { "label": "スタイリッシュ", "next": "q2_stylish" },
            { "label": "ナチュラル",     "next": "q2_natural" }
          ]
        },

        { "id": "q2_stylish", "question": "どんな人に撮ってもらいたい？", "progress": "2 / 4",
          "choices": [
            { "label": "楽しい",  "next": "q3_stylish_fun" },
            { "label": "寄り添い","next": "q3_stylish_yorisoi" }
          ]
        },
        { "id": "q2_natural", "question": "どんな人に撮ってもらいたい？", "progress": "2 / 4",
          "choices": [
            { "label": "楽しい",  "next": "q3_natural_fun" },
            { "label": "寄り添い","next": "q3_natural_yorisoi" }
          ]
        },

        // スタイリッシュ × 楽しい
        { "id": "q3_stylish_fun", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "オシャレ＆かっこいい",     "next": "q4_gender_stylish_fun" },
            { "label": "上品で洗練されている",     "results": ["tatsuki"] }
          ]
        },
        { "id": "q4_gender_stylish_fun", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["taihei", "kenji"] },
            { "label": "WOMAN", "results": ["shiori"] }
          ]
        },

        // スタイリッシュ × 寄り添い
        { "id": "q3_stylish_yorisoi", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "オシャレ＆かっこいい",     "next": "q4_gender_stylish_yorisoi" },
            { "label": "上品で洗練されている",     "results": ["Rio"] }
          ]
        },
        { "id": "q4_gender_stylish_yorisoi", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["takuya"] },
            { "label": "WOMAN", "results": ["iwami"] }
          ]
        },

        // ナチュラル × 楽しい
        { "id": "q3_natural_fun", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "はっきり",       "results": ["konishi", "daisuke"] },
            { "label": "淡い・優しい",   "results": ["zacky", "uchida"] }
          ]
        },

        // ナチュラル × 寄り添い
        { "id": "q3_natural_yorisoi", "question": "好きな色味は？", "progress": "3 / 4",
          "choices": [
            { "label": "はっきり",       "next": "q4_gender_natural_yorisoi_hakkiri" },
            { "label": "淡い・優しい",   "next": "q4_gender_natural_yorisoi_awai" }
          ]
        },
        { "id": "q4_gender_natural_yorisoi_hakkiri", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["bessy"] },
            { "label": "WOMAN", "results": ["Reika"] }
          ]
        },
        { "id": "q4_gender_natural_yorisoi_awai", "question": "フォトグラファーの性別は？", "progress": "4 / 4",
          "choices": [
            { "label": "MAN",   "results": ["motti"] },
            { "label": "WOMAN", "results": ["honoka"] }
          ]
        }
      ],
      "photographers": [
        { "id": "taihei",  "name": "taihei",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "kenji",   "name": "kenji",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "shiori",  "name": "shiori",  "comment": "寄り添いタイプ。二人の雰囲気＋おしゃれな写真を残せる", "portfolio_url": "https://www.la-viephoto.com/photo_g/shiori-sugimoto" },
        { "id": "tatsuki", "name": "tatsuki", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "takuya",  "name": "takuya",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "iwami",   "name": "iwami",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "Rio",     "name": "Rio",     "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "konishi", "name": "konishi", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "daisuke", "name": "daisuke", "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "zacky",   "name": "zacky",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "uchida",  "name": "uchida",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "bessy",   "name": "bessy",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "Reika",   "name": "Reika",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },

        { "id": "motti",   "name": "motti",   "comment": "※店舗コメントをここに入力", "portfolio_url": "" },
        { "id": "honoka",  "name": "honoka",  "comment": "※店舗コメントをここに入力", "portfolio_url": "" }
      ]
    };
    // ====== 内蔵データここまで ======

    const state = { step: "q1", results: null };

    function findNode(id) {
      return DATA.nodes.find(n => n.id === id);
    }
    function resolvePhotographers(ids) {
      const map = new Map(DATA.photographers.map(p => [p.id, p]));
      return ids.map(id => map.get(id)).filter(Boolean);
    }

    function renderQuestion(node) {
      const el = document.getElementById('card');
      el.innerHTML = `
        <h2>${node.question}</h2>
        <div class="choices">
          ${node.choices.map(c => `
            <button class="choice"
              data-next='${c.next || ""}'
              data-results='${c.results ? JSON.stringify(c.results) : ""}'>
              ${c.label}
            </button>
          `).join('')}
        </div>
        <div class="progress">${node.progress || ""}</div>
      `;
      el.classList.remove('hidden');

      document.querySelectorAll('.choice').forEach(btn => {
        btn.onclick = (e) => {
          const t = e.currentTarget;
          const resultsStr = t.getAttribute('data-results');
          if (resultsStr) {
            try { state.results = JSON.parse(resultsStr); } catch { state.results = []; }
            state.step = "FINAL";
            run();
            return;
          }
          const next = t.getAttribute('data-next');
          state.step = next || "FINAL";
          run();
        };
      });
    }

    function renderResult() {
      const ids = Array.isArray(state.results) ? state.results : [];
      const list = resolvePhotographers(ids);

      const wrap = document.getElementById('pgList');
      wrap.innerHTML = list.map(p => {
        const url = p.portfolio_url || DEFAULT_PORTFOLIO_URL;
        const safeUrl = String(url);
        return `
          <article class="pg">
            <div class="pg-meta">
              <h3>${p.name}</h3>
              ${p.comment ? `<p class="comment">${p.comment}</p>` : ``}
            </div>
            ${safeUrl}
              作品を見る
            </a>
          </article>
        `;
      }).join('') || `<p>該当のPGが見つかりませんでした。</p>`;

      document.getElementById('card').classList.add('hidden');
      const r = document.getElementById('result');
      r.classList.remove('hidden');

      // —— 確実に開くためのフォールバック：window.open を明示的に実行 ——
      document.querySelectorAll('.open-link').forEach(a => {
        a.addEventListener('click', (ev) => {
          // 一部ブラウザで a.click() が無視されるケースに対応
          const href = ev.currentTarget.getAttribute('data-href');
          if (!href) return;
          // 既定の遷移を尊重しつつ、念のため window.open を試行
          const w = window.open(href, '_blank', 'noopener');
          // ポップアップブロック対策：失敗したら同タブ遷移
          if (!w) { window.location.href = href; }
        }, { passive: true });
      });

      document.getElementById('restart').onclick = () => {
        state.step = "q1";
        state.results = null;
        document.getElementById('result').classList.add('hidden');
        run();
      };
    }

    function run() {
      if (state.step === "FINAL") return renderResult();
      const node = findNode(state.step);
      if (!node) { state.step = "FINAL"; return renderResult(); }
      renderQuestion(node);
    }

    run();
  </script>
</body>
</html>
